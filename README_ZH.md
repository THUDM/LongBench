![](misc/logo.gif)
<p align="center">
    ğŸ¤— <a href="https://huggingface.co/datasets/THUDM/LongBench" target="_blank">HF Repo</a> â€¢ ğŸ“ƒ Paper coming soon!
</p>

Read this in [English](README.md).

# LongBench: å¤šè¯­è¨€ã€å¤šä»»åŠ¡é•¿æ–‡æœ¬ç†è§£è¯„æµ‹åŸºå‡†

**LongBench**æ˜¯ç¬¬ä¸€ä¸ªå¤šè¯­è¨€ã€å¤šä»»åŠ¡ã€å…¨é¢è¯„ä¼°å¤§è¯­è¨€æ¨¡å‹**é•¿æ–‡æœ¬ç†è§£**èƒ½åŠ›çš„ç»¼åˆæ•°æ®é›†ã€‚åœ¨ç›®å‰å¤§æ¨¡å‹å¤šè¯­è¨€èƒ½åŠ›å¼•èµ·å¹¿æ³›å…³æ³¨çš„èƒŒæ™¯ä¸‹ï¼ŒLongBenchæ¶µç›–äº†ä¸åŒçš„è¯­è¨€ï¼ˆä¸­æ–‡å’Œè‹±æ–‡ï¼‰ï¼Œä»¥æ­¤æ¥å¯¹å¤§æ¨¡å‹åœ¨é•¿æ–‡æœ¬ä¸‹çš„å¤šè¯­è¨€èƒ½åŠ›è¿›è¡Œæ›´å…¨é¢çš„è¯„ä¼°ã€‚åŒæ—¶ï¼ŒLongBenchç”±äºŒåä¸ªä¸åŒçš„ä»»åŠ¡ç»„æˆï¼Œè¦†ç›–äº†å•æ–‡æ¡£QAã€å¤šæ–‡æ¡£QAã€æ‘˜è¦ã€Few-shotå­¦ä¹ ã€ä»£ç è¡¥å…¨å’Œåˆæˆä»»åŠ¡ç­‰å…³é”®çš„é•¿æ–‡æœ¬åº”ç”¨åœºæ™¯ã€‚

æˆ‘ä»¬æ·±çŸ¥æ¨¡å‹è¯„æµ‹è¿‡ç¨‹ä¸­å¯èƒ½äº§ç”Ÿçš„é«˜æ˜‚æˆæœ¬ï¼Œå°¤å…¶æ˜¯é•¿æ–‡æœ¬åœºæ™¯ä¸‹ï¼ˆå¦‚äººå·¥æ ‡æ³¨æˆæœ¬æˆ–APIè°ƒç”¨æˆæœ¬ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä¸€ç§å…¨è‡ªåŠ¨çš„è¯„æµ‹æ–¹å¼ï¼Œæ—¨åœ¨ä»¥æœ€ä½çš„æˆæœ¬ï¼Œæœ€æœ‰æ•ˆåœ°è¡¡é‡å’Œè¯„ä¼°æ¨¡å‹çš„é•¿æ–‡æœ¬ç†è§£èƒ½åŠ›ã€‚

LongBenchåŒ…å«13ä¸ªè‹±æ–‡ä»»åŠ¡ã€5ä¸ªä¸­æ–‡ä»»åŠ¡å’Œ2ä¸ªä»£ç ä»»åŠ¡ï¼Œå¤šæ•°ä»»åŠ¡çš„å¹³å‡é•¿åº¦åœ¨5k-15kä¹‹é—´ï¼Œå…±åŒ…å«çº¦4500æ¡æµ‹è¯•æ•°æ®ã€‚ä»ä¸»è¦ä»»åŠ¡åˆ†ç±»ä¸Šï¼ŒLongBenchåŒ…å«å…­å¤§ç±»ä»»åŠ¡ï¼Œå³å•æ–‡æ¡£QAã€å¤šæ–‡æ¡£QAã€æ‘˜è¦ã€Few-shotå­¦ä¹ ã€ä»£ç è¡¥å…¨å’Œåˆæˆä»»åŠ¡ã€‚å…³äºLongBenchæ•°æ®é›†çš„å…·ä½“ç»Ÿè®¡åŠä»»åŠ¡æ„é€ æ–¹å¼è¯·å‚è€ƒ[è¿™é‡Œ](task_zh.md)ã€‚

|   ä»»åŠ¡ç±»å‹   | è‹±æ–‡ä»»åŠ¡æ•° | ä¸­æ–‡ä»»åŠ¡æ•° | ä»£ç ä»»åŠ¡æ•° |
| :----------: | :--------: | :--------: | :--------: |
|   å•æ–‡æ¡£QA   |     3      |     1      |     -      |
|   å¤šæ–‡æ¡£QA   |     3      |     1      |     -      |
|     æ‘˜è¦     |     2      |     1      |     -      |
| Few-shotå­¦ä¹  |     3      |     1      |     -      |
|   åˆæˆä»»åŠ¡   |     2      |     1      |     -      |
|   ä»£ç è¡¥å…¨   |     -      |     -      |     2      |

## ç›®å½•
- [æ’è¡Œæ¦œ](#æ’è¡Œæ¦œ)
- [å¦‚ä½•åœ¨LongBenchä¸Šè¯„æµ‹æ¨¡å‹](#å¦‚ä½•åœ¨LongBenchä¸Šè¯„æµ‹æ¨¡å‹)
- [è¯¦ç»†è¯„æµ‹ç»“æœ](#è¯¦ç»†è¯„æµ‹ç»“æœ)
- [è‡´è°¢](#è‡´è°¢)
- [å¼•ç”¨](#å¼•ç”¨)

## æ’è¡Œæ¦œ
æˆ‘ä»¬åœ¨è¿™é‡Œå±•ç¤ºäº†æ‰€æœ‰æ¨¡å‹åœ¨Zero-shotåœºæ™¯ä¸‹ï¼Œåœ¨ä¸­æ–‡å’Œè‹±æ–‡å„å¤§ç±»ä»»åŠ¡ä¸Šå¾—åˆ†çš„å¹³å‡å€¼ï¼ˆ%ï¼‰ï¼Œå„ä»»åŠ¡è¯„ä¼°æ‰€ç”¨æŒ‡æ ‡è¯·å‚è€ƒ[è¿™é‡Œ](task_zh.md)ã€‚
#### è‹±æ–‡æ¦œå•
|     | Avg | å•æ–‡æ¡£QA | å¤šæ–‡æ¡£QA | æ‘˜è¦ | Few-shotå­¦ä¹  | ä»£ç è¡¥å…¨ | åˆæˆä»»åŠ¡ |
| --- | :-: | :-: | :-: | :-: | :-: | :-: | :-: |
| GPT-3.5-Turbo-16k | 45.5 | 39.8 | 38.7 | 26.5 | 76.0 | 54.5 | 37.8 |
| Llama2-7B-chat-4k | 29.0 | 24.8 | 21.4 | 23.9 | 50.5 | 47.3 | 5.9 |
| LongChat-7B-16k | 33.7 | 29.3 | 16.1 | 25.8 | 59.9 | 57.0 | 14.2 |
| XGen-7B-8k | 28.7 | 24.5 | 20.4 | 24.8 | 58.7 | 38.0 | 5.6 |
| InternLM-7B-8k | 24.7 | 17.1 | 20.8 | 13.3 | 52.7 | 39.7 | 4.7 |
| ChatGLM2-6B | 26.0 | 23.1 | 15.0 | 22.9 | 46.1 | 46.1 | 2.7 |
| ChatGLM2-6B-32k | 42.7 | 32.8 | 34.0 | 28.6 | 68.1 | 52.7 | 39.8 |

#### ä¸­æ–‡æ¦œå•
|       | Avg | å•æ–‡æ¡£QA | å¤šæ–‡æ¡£QA | æ‘˜è¦ | Few-shotå­¦ä¹  | ä»£ç è¡¥å…¨ | åˆæˆä»»åŠ¡ |
|-------|:---:|:-------------:|:------------:|:-------------:|:-----------------:|:---------------:|:----------------:|
| GPT-3.5-Turbo-16k | 44.5 | 61.2 | 28.7 | 16.0 | 29.2 | 54.5 | 77.5 |
| Llama2-7B-chat-4k | 13.5 | 11.6 | 1.9 | 0.2 | 19.8 | 47.3 | 0.5 |
| LongChat-7B-16k | 23.7 | 26.6 | 19.1 | 14.0 | 20.8 | 57.0 | 4.8 |
| XGen-7B-8k | 14.5 | 14.2 | 9.1 | 1.5 | 20.0 | 38.0 | 4.2 |
| InternLM-7B-8k | 18.6 | 33.3 | 8.9 | 13.0 | 15.5 | 39.7 | 0.9 |
| ChatGLM2-6B | 22.5 | 33.0 | 15.2 | 14.6 | 20.5 | 46.1 | 5.5 |
| ChatGLM2-6B-32k | 41.3 | 52.0 | 34.3 | 16.3 | 29.9 | 52.7 | 62.5 |

#### é•¿æ–‡æœ¬ä»»åŠ¡èƒ½åŠ›é›·è¾¾å›¾
![](misc/radar.png)

#### ä¸åŒé•¿åº¦æ–‡æœ¬ä¸‹çš„èƒ½åŠ›å˜åŒ–
ä¸ºäº†æ›´æœ‰é’ˆå¯¹æ€§åœ°åˆ†ææ¨¡å‹åœ¨ä¸åŒæ–‡æœ¬é•¿åº¦ä¸‹çš„ç›¸å¯¹è¡¨ç°ï¼Œä¸‹å›¾å±•ç¤ºäº†æ¨¡å‹åœ¨ä¸åŒæ–‡æœ¬é•¿åº¦åŒºé—´ä¸Šï¼Œæ‰€æœ‰ä»»åŠ¡ä¸Šçš„å¹³å‡ç›¸å¯¹åˆ†æ•°ã€‚
![](misc/curve.png)

> æ³¨ï¼šå‡è®¾æ¨¡å‹åœ¨æŸä¸ªä»»åŠ¡çš„ç‰¹å®šé•¿åº¦èŒƒå›´å†…æ•°æ®ä¸Šå¾—åˆ†ä¸ºxï¼Œåœ¨è¯¥ä»»åŠ¡æ‰€æœ‰æ•°æ®ä¸Šå¾—åˆ†ä¸ºyï¼Œåˆ™æ¨¡å‹åœ¨è¯¥é•¿åº¦èŒƒå›´çš„**ç›¸å¯¹åˆ†æ•°**ä¸º(x/y-1)ã€‚ä¸ºäº†æ›´å¥½æ¯”è¾ƒä¸åŒæ¨¡å‹çš„å˜åŒ–è¶‹åŠ¿ï¼Œæˆ‘ä»¬åœ¨0-4kå°†æ‰€æœ‰æŠ˜çº¿å¹³ç§»è‡³0ã€‚

## å¦‚ä½•åœ¨LongBenchä¸Šè¯„æµ‹æ¨¡å‹

#### è½½å…¥æ•°æ®
ä½ å¯ä»¥é€šè¿‡Hugging Face datasetsæ¥ä¸‹è½½å¹¶è½½å…¥**LongBench**çš„æ•°æ®ï¼ˆ[ğŸ¤— HF Repo](https://huggingface.co/datasets/THUDM/LongBench)ï¼‰:
```python
from datasets import load_dataset

datasets = ["hotpotqa", "2wikimqa", "musique", "dureader", "narrativeqa", "qasper", "multifieldqa_en", \
    "multifieldqa_zh", "gov_report", "qmsum", "vcsum", "trec", "nq", "triviaqa", "lsht", "passage_count", \
    "passage_retrieval_en", "passage_retrieval_zh", "lcc", "repobench-p"]

for dataset in datasets:
    data = load_dataset('THUDM/LongBench', dataset, split='test')
```
åŒæ ·åœ°ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ç”¨è¿™ä¸ª[é“¾æ¥](https://huggingface.co/datasets/THUDM/LongBench/resolve/main/data.zip)ä¸‹è½½æ‰€æœ‰çš„è¯„æµ‹æ•°æ®ã€‚

#### æ•°æ®æ ¼å¼
**LongBench**ä¸­æ‰€æœ‰æ•°æ®éƒ½ç»Ÿä¸€ä¸ºä»¥ä¸‹æ ¼å¼ï¼š
```json
{
    "input": "ä»»åŠ¡çš„è¾“å…¥/æŒ‡ä»¤ï¼Œé€šå¸¸è¾ƒçŸ­ï¼Œæ¯”å¦‚QAä¸­çš„é—®é¢˜ã€Few-shotä»»åŠ¡ä¸­çš„æé—®ç­‰",
    "context": "ä»»åŠ¡æ‰€éœ€çš„é•¿è¯­å¢ƒæ–‡æœ¬ï¼Œæ¯”å¦‚æ–‡æ¡£ã€è·¨æ–‡ä»¶ä»£ç ã€Few-shotä»»åŠ¡ä¸­çš„few-shotæ ·æœ¬",
    "answers": "ç”±æ‰€æœ‰æ ‡å‡†ç­”æ¡ˆç»„æˆçš„åˆ—è¡¨",
    "length": "å‰ä¸‰é¡¹æ–‡æœ¬çš„æ€»é•¿åº¦ï¼ˆä¸­ã€è‹±æ–‡åˆ†åˆ«ç”¨å­—ã€è¯æ•°ç»Ÿè®¡ï¼‰",
    "dataset": "æœ¬æ¡æ•°æ®æ‰€å±æ•°æ®é›†åç§°",
    "language": "æœ¬æ¡æ•°æ®çš„è¯­è¨€",
    "all_classes": "åˆ†ç±»ä»»åŠ¡ä¸­çš„æ‰€æœ‰ç±»åˆ«ï¼Œéåˆ†ç±»ä»»åŠ¡åˆ™ä¸ºnull",
    "_id": "æ¯æ¡æ•°æ®çš„éšæœºid"
}
```

#### è¯„æµ‹
æˆ‘ä»¬ä»¥ChatGLM2-6Bä¸ºä¾‹æä¾›äº†ä¸€ä»½è¯„æµ‹ä»£ç ã€‚é¦–å…ˆï¼Œè¿è¡Œä»“åº“ä¸‹çš„[pred.py](pred.py)
```bash
CUDA_VISIBLE_DEVICES=0 python pred.py
```
å¯ä»¥åœ¨`pred/`æ–‡ä»¶å¤¹ä¸‹å¾—åˆ°æ¨¡å‹åœ¨æ‰€æœ‰æ•°æ®é›†ä¸‹çš„è¾“å‡ºï¼Œæ­¤åè¿è¡Œ[eval.py](eval.py)çš„è¯„æµ‹ä»£ç ï¼š
```bash
python eval.py
```
å¯ä»¥åœ¨`result.json`ä¸­å¾—åˆ°åœ¨å„æ•°æ®é›†ä¸Šçš„è¯„æµ‹ç»“æœã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨`config/`ä¸‹æä¾›äº†æˆ‘ä»¬æ€»ç»“å‡ºæ¥çš„åœ¨å„æ•°æ®é›†ä¸Šé€‚åˆçš„è¾“å…¥æ ¼å¼å’Œæœ€å¤§è¾“å‡ºé•¿åº¦é™åˆ¶ï¼Œåœ¨è¯„æµ‹çš„æ—¶å€™å¯ä»¥è¿›è¡Œä¿®æ”¹ä»¥æ›´å¥½åœ°é€‚ç”¨ä½ è¦è¯„æµ‹çš„æ¨¡å‹ï¼Œä¿®æ”¹ååœ¨[pred.py](pred.py)è¯„æµ‹æ—¶ä¼šè‡ªåŠ¨æŒ‰ç…§æ–°çš„æ ¼å¼å»æ•´ç†æ•°æ®å¹¶å¾—åˆ°å¯¹åº”çš„æ¨¡å‹è¾“å‡ºã€‚

## è¯¦ç»†è¯„æµ‹ç»“æœ
ä¸‹é¢çš„å‡ å¼ è¡¨æ ¼å±•ç¤ºäº†æ¨¡å‹åœ¨æ‰€æœ‰å­ä»»åŠ¡æ•°æ®é›†ä¸Šçš„Zero-shotè¯„æµ‹ç»“æœï¼ˆ%ï¼‰ï¼Œå…¶ä¸­çš„ä¸­æ–‡æ•°æ®é›†ä»¥â€œzhâ€æ ‡ç¤ºï¼ˆå„ä»»åŠ¡è¯„ä¼°æ‰€ç”¨æŒ‡æ ‡è¯·å‚è€ƒ[è¿™é‡Œ](task_zh.md)ï¼‰ã€‚
> æ³¨ï¼šå¯¹äºè¶…å‡ºæ¨¡å‹å¤„ç†é•¿åº¦èƒ½åŠ›çš„æ–‡æœ¬ï¼Œå‚è€ƒ[Lost in the Middle](https://arxiv.org/abs/2307.03172)çš„è§‚å¯Ÿï¼Œæˆ‘ä»¬ä»æ–‡æœ¬ä¸­é—´è¿›è¡Œæˆªæ–­ï¼Œä¿æŒå‰åéƒ¨åˆ†çš„ä¿¡æ¯ã€‚å®éªŒè¡¨æ˜ï¼Œè¿™ç§æˆªæ–­æ–¹å¼å¯¹æ¨¡å‹æ€§èƒ½å½±å“æœ€å°ã€‚
#### å•æ–‡æ¡£QA
|                   | NarrativeQA | Qasper | MultiFieldQA-en | MultiFieldQA-zh |
|-------------------|:-----------:|:------:|:---------------:|:---------------:|
| GPT-3.5-Turbo-16k | 23.6 | 43.3 | 52.3 | 61.2 |
| Llama2-7B-chat-4k | 19.1 | 19.6 | 35.8 | 11.6 |
| LongChat-7B-16k | 21.6 | 21.6 | 44.6 | 26.6 |
| XGen-7B-8k | 17.9 | 18.3 | 37.2 | 14.2 |
| InternLM-7B-8k | 12.4 | 16.8 | 22.3 | 33.3 |
| ChatGLM2-6B | 11.2 | 23.7 | 34.2 | 33.0 |
| ChatGLM2-6B-32k | 20.4 | 32.2 | 45.7 | 52.0 |

#### å¤šæ–‡æ¡£QA
|                      | HotpotQA | 2WikiMQA | Musique | DuReader (zh) |
|----------------------|:--------:|:--------:|:-------:|:--------:|
| GPT-3.5-Turbo-16k | 51.6 | 37.7 | 26.9 | 28.7 |
| Llama2-7B-chat-4k | 24.3 | 31.4 | 8.6 | 1.9 |
| LongChat-7B-16k | 22.4 | 16.8 | 9.1 | 19.1 |
| XGen-7B-8k | 28.3 | 21.5 | 11.5 | 9.1 |
| InternLM-7B-8k | 27.9 | 24.0 | 10.3 | 8.9 |
| ChatGLM2-6B | 20.2 | 19.6 | 5.3 | 15.2 |
| ChatGLM2-6B-32k | 44.9 | 34.9 | 22.2 | 34.3 |

#### æ‘˜è¦
|            | GovReport | QMSum | VCSUM (zh) |
|:-----------|:---------:|:-----:|:-----:|
| GPT-3.5-Turbo-16k | 29.5 | 23.4 | 16.0 |
| Llama2-7B-chat-4k | 27.3 | 20.6 | 0.2 |
| LongChat-7B-16k | 28.4 | 23.2 | 14.0 |
| XGen-7B-8k | 27.8 | 21.7 | 1.5 |
| InternLM-7B-8k | 9.8 | 16.8 | 13.0 |
| ChatGLM2-6B | 23.7 | 22.2 | 14.6 |
| ChatGLM2-6B-32k | 33.3 | 23.9 | 16.3 |

#### Few-shotå­¦ä¹ 
|     | TREC | NQ | TriviaQA | LSHT (zh) |
| --- | :-: | :-: | :-: | :-: |
| GPT-3.5-Turbo-16k | 68.0 | 73.0 | 87.1 | 29.2 |
| Llama2-7B-chat-4k | 60.5 | 31.4 | 59.7 | 19.8 |
| LongChat-7B-16k | 61.5 | 44.8 | 73.5 | 20.8 |
| XGen-7B-8k | 66.0 | 43.2 | 67.0 | 20.0 |
| InternLM-7B-8k | 49.0 | 47.6 | 61.6 | 15.5 |
| ChatGLM2-6B | 44.0 | 34.5 | 59.8 | 20.5 |
| ChatGLM2-6B-32k | 62.0 | 64.9 | 77.6 | 29.9 |

#### ä»£ç è¡¥å…¨
|     | LCC | RepoBench-P |
| --- | :-: | :-: |
| GPT-3.5-Turbo-16k | 54.7 | 54.3 |
| Llama2-7B-chat-4k | 52.3 | 42.4 |
| LongChat-7B-16k | 59.2 | 54.7 |
| XGen-7B-8k | 38.8 | 37.3 |
| InternLM-7B-8k | 45.5 | 34.0 |
| ChatGLM2-6B | 48.4 | 43.7 |
| ChatGLM2-6B-32k | 55.4 | 50.0 |

#### åˆæˆä»»åŠ¡
|     | PassageRetrieval-en | Passage Count | PassageRetrieval-zh |
| --- | :-: | :-: | :-: |
| GPT-3.5-Turbo-16k | 71.0 | 4.5 | 77.5 |
| Llama2-7B-chat-4k | 9.2 | 2.5 | 0.5 |
| LongChat-7B-16k | 24.0 | 4.5 | 4.8 |
| XGen-7B-8k | 9.0 | 2.2 | 4.2 |
| InternLM-7B-8k | 6.5 | 2.9 | 0.9 |
| ChatGLM2-6B | 3.2 | 2.1 | 5.5 |
| ChatGLM2-6B-32k | 77.5 | 2.0 | 62.5 |

## è‡´è°¢
- **LongBench**çš„éƒ¨åˆ†ä»»åŠ¡åŸºäºä¹‹å‰çš„ç ”ç©¶è€…æå‡ºçš„æ•°æ®é›†æ„å»ºï¼ŒåŒ…æ‹¬[HotpotQA](https://hotpotqa.github.io/)ï¼Œ[2WikiMultihopQA](https://aclanthology.org/2020.coling-main.580/)ï¼Œ[Musique](https://arxiv.org/abs/2108.00573)ï¼Œ[DuReader](https://github.com/baidu/DuReader)ï¼Œ[NarrativeQA](https://arxiv.org/pdf/1712.07040.pdf)ï¼Œ[Qasper](https://arxiv.org/pdf/2105.03011.pdf)ï¼Œ[GovReport](https://arxiv.org/pdf/2104.02112.pdf)ï¼Œ[QMSum](https://arxiv.org/pdf/2104.05938.pdf)ï¼Œ[VCSUM](https://arxiv.org/abs/2305.05280)ï¼Œ[TriviaQA](https://nlp.cs.washington.edu/triviaqa/)ï¼Œ[NQ](https://ai.google.com/research/NaturalQuestions/)ï¼Œ[TREC](https://aclanthology.org/C02-1150.pdf)ï¼Œ[LSHT](http://tcci.ccf.org.cn/conference/2014/dldoc/evatask6.pdf)ï¼Œ[LCC](https://arxiv.org/abs/2306.14893)å’Œ[RepoBench-P](https://arxiv.org/abs/2306.03091)ã€‚

## å¼•ç”¨
æœ¬å·¥ä½œç”±**THU-KEG**å’Œ**Zhipu AI**å…±åŒå®Œæˆï¼Œç›¸å…³è®ºæ–‡æ­£åœ¨æ’°å†™ä¸­ï¼Œå±Šæ—¶å°†æ›´æ–°å¼•ç”¨ä¿¡æ¯ï¼Œæ•¬è¯·å…³æ³¨~

å¦‚æœæ‚¨ä½¿ç”¨Longbenchï¼Œè¯·ä¸€å¹¶å¼•ç”¨LongBenchæ‰€åŸºäºçš„æ•°æ®é›†å¯¹åº”çš„è®ºæ–‡ï¼Œç›¸å…³å¼•ç”¨ä¿¡æ¯åœ¨[è¿™é‡Œ](refs/ref.bib)ã€‚
